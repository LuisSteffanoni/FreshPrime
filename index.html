<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fresh Prime - Orden de Compra CORE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #083645, #032425, #416858, #057BC1);
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
            color: #F8F4ED;
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 2rem;
        }
        @keyframes gradientAnimation {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }
        .cover-page {
            background: linear-gradient(135deg, rgba(9, 51, 44, 0.2), rgba(65, 104, 88, 0.3));
            backdrop-filter: blur(15px);
            width: 100%;
            display: flex;
            flex-direction: column;
            page-break-after: always;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            color: #F8F4ED;
            padding: 10px;
            box-sizing: border-box;
            position: relative;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(244, 237, 228, 0.2);
            animation: fadeIn 1s ease-in;
            margin-bottom: 2rem;
        }
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .upper-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            padding-bottom: 20px;
        }
        @media (min-width: 768px) {
            .upper-section {
                height: 60%;
                flex-direction: row;
                justify-content: space-between;
                padding: 20px;
                padding-bottom: 40px;
            }
        }
        .logo-container {
            width: 100%;
            text-align: center;
            padding-right: 0;
        }
        @media (min-width: 768px) {
            .logo-container {
                width: 30%;
                text-align: left;
                padding-right: 20px;
            }
        }
        .info-container {
            width: 100%;
            text-align: center;
            margin-top: 10px;
        }
        @media (min-width: 768px) {
            .info-container {
                width: 70%;
                text-align: left;
                margin-top: 0;
            }
        }
        .banner {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            background: linear-gradient(135deg, rgba(3, 36, 37, 0.2), rgba(65, 104, 88, 0.3));
            backdrop-filter: blur(15px);
            border-radius: 15px;
        }
        .banner img {
            width: 100%;
            height: auto;
            object-fit: contain;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            z-index: 1;
        }
        @media (min-width: 768px) {
            .banner {
                height: 40%;
                padding: 10px;
                padding-top: 40px;
            }
            .banner img {
                width: 80%;
            }
        }
        .cover-page img.logo {
            max-width: 150px;
            width: 100%;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            z-index: 1;
        }
        @media (min-width: 768px) {
            .cover-page img.logo {
                max-width: 200px;
            }
        }
        .cover-page img.logo::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(140, 186, 127, 0.5);
            opacity: 0.7;
            z-index: -1;
            animation: none;
        }
        .cover-page h1 {
            font-size: 18px;
            margin: 5px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            z-index: 1;
            color: #F8F4ED;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }
        .cover-page p {
            font-size: 12px;
            margin: 5px 0;
            z-index: 1;
            color: #E5EAE6;
        }
        @media (min-width: 768px) {
            .cover-page h1 { font-size: 24px; }
            .cover-page p { font-size: 16px; }
        }
        .wave-line {
            width: 50%;
            height: 2px;
            background: rgba(140, 186, 127, 0.5);
            margin: 10px auto;
            border-radius: 2px;
            z-index: 1;
        }
        .info-container {
            border-left: 2px solid rgba(140, 186, 127, 0.5);
            padding-left: 15px;
            box-shadow: 4px 0 5px rgba(0, 0, 0, 0.1);
        }
        .container {
            max-width: 100%;
            margin: 10px auto;
            background: linear-gradient(135deg, rgba(9, 51, 44, 0.2), rgba(65, 104, 88, 0.3));
            backdrop-filter: blur(15px);
            padding: 10px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(244, 237, 228, 0.2);
        }
        @media (min-width: 768px) {
            .container {
                max-width: 1200px;
                margin: 20px auto;
                padding: 20px;
            }
        }
        .header {
            text-align: center;
            border-bottom: 2px solid #8CBA7F;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }
        .header h2 {
            color: #F8F4ED;
            font-size: 18px;
            margin: 5px 0;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }
        @media (min-width: 768px) {
            .header { border-bottom: 3px solid #8CBA7F; padding-bottom: 15px; margin-bottom: 20px; }
            .header h2 { font-size: 24px; margin: 10px 0; }
        }
        h1 {
            text-align: center;
            color: #F8F4ED;
            font-size: 20px;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }
        @media (min-width: 768px) {
            h1 { font-size: 28px; }
        }
        .filter-section {
            text-align: center;
            margin-bottom: 8px;
            color: #E5EAE6;
        }
        select, input[type="text"] {
            padding: 6px;
            font-size: 14px;
            margin: 4px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(244, 237, 228, 0.2);
            border-radius: 10px;
            color: #F8F4ED;
            backdrop-filter: blur(5px);
        }
        select option {
            background: #032425;
            color: #F8F4ED;
        }
        @media (min-width: 768px) {
            .filter-section { margin-bottom: 20px; }
            select, input[type="text"] { padding: 10px; font-size: 16px; margin: 10px 0; }
        }
        .product-table {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 8px;
            display: none;
        }
        @media (max-width: 768px) {
            .product-table {
                gap: 8px;
                padding: 4px;
            }
            .product-card {
                width: 100%;
            }
        }
        @media (min-width: 768px) {
            .product-table {
                gap: 15px;
                padding: 15px;
            }
        }
        .product-card {
            background: linear-gradient(135deg, rgba(3, 36, 37, 0.2), rgba(65, 104, 88, 0.3));
            backdrop-filter: blur(15px);
            padding: 8px;
            border: 1px solid rgba(244, 237, 228, 0.2);
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
        }
        @media (min-width: 768px) {
            .product-card { padding: 12px; }
        }
        .product-card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            transform: scale(1.02);
        }
        .product-card h3 {
            margin: 0;
            color: #F8F4ED;
            font-size: 14px;
        }
        .product-card p {
            margin: 4px 0;
            color: #E5EAE6;
            font-size: 10px;
        }
        @media (min-width: 768px) {
            .product-card h3 { font-size: 16px; }
            .product-card p { margin: 5px 0; font-size: 12px; }
        }
        .free-item {
            border: 2px solid #8CBA7F;
            background: rgba(232, 245, 233, 0.2);
        }
        .quantity-controls {
            margin: 4px 0;
        }
        @media (min-width: 768px) {
            .quantity-controls { margin: 8px 0; }
        }
        .quantity-input {
            padding: 4px;
            width: 40px;
            text-align: center;
            border: 1px solid rgba(244, 237, 228, 0.2);
            border-radius: 5px;
            font-size: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: #F8F4ED;
            backdrop-filter: blur(5px);
        }
        @media (min-width: 768px) {
            .quantity-input { padding: 5px; width: 50px; font-size: 14px; }
        }
        .notes-btn {
            padding: 4px 6px;
            background: linear-gradient(45deg, #8CBA7F, #00664D);
            color: #F8F4ED;
            border: none;
            cursor: pointer;
            margin-top: 4px;
            border-radius: 10px;
            font-size: 10px;
            transition: transform 0.3s ease, background 0.3s ease;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        .notes-btn:hover {
            transform: scale(1.05);
            background: linear-gradient(45deg, #A8A24A, #D4D687);
        }
        @media (min-width: 768px) {
            .notes-btn { padding: 5px 8px; margin-top: 8px; font-size: 12px; }
        }
        .notes-input {
            width: 100%;
            padding: 4px;
            margin-top: 4px;
            border: 1px solid rgba(244, 237, 228, 0.2);
            border-radius: 5px;
            font-size: 10px;
            display: none;
            background: rgba(255, 255, 255, 0.1);
            color: #F8F4ED;
            backdrop-filter: blur(5px);
        }
        @media (min-width: 768px) {
            .notes-input { padding: 5px; margin-top: 8px; font-size: 12px; }
        }
        .price, .item-total {
            font-weight: bold;
            color: #F8F4ED;
            font-size: 12px;
        }
        @media (min-width: 768px) {
            .price, .item-total { font-size: 14px; }
        }
        .buttons {
            text-align: center;
            margin-top: 8px;
            color: #E5EAE6;
        }
        .btn {
            padding: 6px 10px;
            border: none;
            color: #F8F4ED;
            cursor: pointer;
            margin: 4px;
            font-size: 12px;
        }
        @media (min-width: 768px) {
            .buttons { margin-top: 15px; }
            .btn { padding: 8px 12px; font-size: 14px; }
        }
        .print-resumen-button, .excel-button, .whatsapp-button {
            background: linear-gradient(45deg, #8CBA7F, #00664D);
            padding: 6px 10px;
            border: none;
            color: #F8F4ED;
            cursor: pointer;
            margin: 4px;
            border-radius: 10px;
            font-size: 12px;
            transition: transform 0.3s ease, background 0.3s ease;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        .print-resumen-button:hover, .excel-button:hover, .whatsapp-button:hover {
            transform: scale(1.05);
            background: linear-gradient(45deg, #A8A24A, #D4D687);
        }
        @media (min-width: 768px) {
            .print-resumen-button, .excel-button, .whatsapp-button { padding: 8px 12px; font-size: 14px; }
        }
        .link {
            color: #4DDBFF;
            text-decoration: none;
            font-weight: bold;
        }
        .link:hover {
            color: #F1FF58;
            text-decoration: underline;
        }
        @media (max-width: 768px) {
            .link { font-size: 10px; }
        }
        @media (min-width: 768px) {
            .link { font-size: 12px; }
        }
        footer {
            text-align: center;
            padding: 8px;
            background: radial-gradient(circle, rgba(3, 36, 37, 0.6), rgba(9, 51, 44, 0.4));
            backdrop-filter: blur(15px);
            color: #F8F4ED;
            margin-top: 8px;
            font-weight: bold;
            letter-spacing: 1px;
            font-size: 10px;
            border-top: 1px solid rgba(244, 237, 228, 0.2);
        }
        @media (min-width: 768px) {
            footer { padding: 12px; margin-top: 20px; font-size: 12px; }
        }
        .loading {
            text-align: center;
            font-size: 14px;
            color: #8CBA7F;
            display: block;
        }
        .loading::after {
            content: "🍎";
            animation: spin 0.8s infinite;
        }
        @media (min-width: 768px) {
            .loading { font-size: 16px; }
        }
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }
        .total-section {
            text-align: right;
            font-weight: bold;
            font-size: 12px;
            margin-right: 4%;
            margin-top: 8px;
            color: #E5EAE6;
        }
        @media (min-width: 768px) {
            .total-section { font-size: 14px; margin-right: 8%; margin-top: 15px; }
        }
        .resumen {
            margin-top: 15px;
            background: linear-gradient(135deg, rgba(3, 36, 37, 0.2), rgba(65, 104, 88, 0.3));
            backdrop-filter: blur(15px);
            padding: 8px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 1px solid rgba(244, 237, 228, 0.2);
        }
        .resumen h2 {
            text-align: center;
            color: #F8F4ED;
            font-size: 16px;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }
        @media (min-width: 768px) {
            .resumen { margin-top: 30px; padding: 15px; }
            .resumen h2 { font-size: 20px; }
        }
        .resumen-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
        }
        .resumen-table th, .resumen-table td {
            padding: 6px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(244, 237, 228, 0.2);
            font-size: 10px;
            color: #E5EAE6;
        }
        .resumen-table th {
            background: linear-gradient(45deg, #8CBA7F, #00664D);
            color: #F8F4ED;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        .resumen-table tr:hover { background: rgba(255, 255, 255, 0.05); }
        @media (min-width: 768px) {
            .resumen-table { margin-top: 10px; }
            .resumen-table th, .resumen-table td { padding: 8px 12px; font-size: 12px; }
        }
        @media print {
    body {
        background: none !important;
        color: #000 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
    .cover-page {
        height: auto;
        margin: 0;
        padding: 0;
        background: #f5f5f5 !important;
        backdrop-filter: none !important;
        box-shadow: none !important;
        border: 1px solid #000 !important;
        border-radius: 0 !important;
        color: #000 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        page-break-after: always;
    }
    .cover-page h1,
    .cover-page p,
    .cover-page span,
    .cover-page .link {
        color: #000 !important; /* Force all text in the cover page to be black */
    }
    .upper-section {
        display: block !important;
        page-break-inside: avoid;
        background: #fff !important;
        backdrop-filter: none !important;
        box-shadow: none !important;
        border: 1px solid #000 !important;
        border-radius: 0 !important;
        color: #000 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
    .banner, .container .header, .filter-section, .buttons, .loading, .total-section, .resumen {
        display: none !important;
    }
    .banner img, .cover-page img.logo, .info-container {
        display: block !important;
        width: 100% !important;
        height: auto !important;
        border: 2px solid #8CBA7F !important;
        box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1) !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
    .wave-line {
        background: #8CBA7F !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
    .info-container {
        border-left: 2px solid #8CBA7F !important;
        box-shadow: none !important;
    }
    .container {
        box-shadow: none;
        border: none;
        margin: 0;
        padding: 8px;
        background: none !important;
        backdrop-filter: none !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
    #product-list.print-visible {
        display: block !important;
        page-break-inside: auto;
    }
    .product-table {
        display: table !important;
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    .product-card {
        display: none !important;
        background: none !important;
        border: none !important;
        box-shadow: none !important;
    }
    .product-card.visible-for-print {
        display: table-row !important;
    }
    .product-card h3,
    .product-card p:nth-child(2),
    .product-card p:nth-child(3),
    .product-card p:nth-child(5) {
        display: table-cell !important;
        padding: 8px;
        border-bottom: 1px solid #000 !important;
        color: #000 !important;
        font-size: 12px !important;
        vertical-align: middle;
    }
    .price {
        color: #000 !important;
    }
    .quantity-controls, .notes-btn, .notes-input, .item-total {
        display: none !important;
    }
    #product-list.print-visible::before {
        content: "Lista de Productos";
        display: block;
        font-size: 16px;
        font-weight: bold;
        text-align: center;
        margin: 10px 0;
        color: #000 !important;
    }
    .product-table::before {
        content: "Producto\tCategoría\tUnidad\tPrecio";
        display: table-row;
        font-weight: bold;
        background: #8CBA7F !important;
        color: #fff !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
    .product-table::before > * {
        display: table-cell;
        padding: 8px;
        border-bottom: 2px solid #000 !important;
    }
    .link {
        color: #8CBA7F !important;
        text-decoration: underline !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
    footer {
        background: none !important;
        backdrop-filter: none !important;
        color: #000 !important;
        border-top: none !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
}
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Cover Page -->
    <div class="cover-page">
        <div class="upper-section">
            <div class="logo-container">
                <img class="logo" src="https://i.imgur.com/HegNprK.jpeg" alt="Fresh Prime Logo">
            </div>
            <div class="info-container">
                <h1>Fresh Prime Group</h1>
                <p>Gestión de Frescura, Soluciones a Medida</p>
                <div class="wave-line"></div>
                <p>Orden de Compra 2025</p>
                <p id="dynamic-timestamp">Del 15 al 30 de Junio 2025</p>
                <p>Contacto: FreshPrimeGroup@outlook.com | Tel: (442) 422-5756, (442) 772-3974</p>
                <p>Visítanos en Instagram: <a href="https://www.instagram.com/fresh_prime_foods?igsh=MWFyendicGV4bnRxMQ%3D%3D&utm_source=qr" target="_blank" class="link">@FreshPrimeFoods</a></p>
            </div>
        </div>
        <div class="banner">
            <img src="https://i.imgur.com/0R2tBOV.jpeg" alt="Futuristic Produce Container">
        </div>
    </div>

    <!-- Order Page (Container for Products) -->
    <div class="container">
        <div class="header">
            <h2>FRESH PRIME - GESTIÓN DE FRESCURA, SOLUCIONES A MEDIDA.</h2>
        </div>
        <h1>Lista de Productos - Precios Del 1 al 15 de Agosto 2025</h1>

        <!-- Search bar and Filter -->
        <div class="filter-section">
            <input type="text" id="search-bar" placeholder="Buscar productos...">
        </div>
        <div class="filter-section">
            <label for="class-filter">Filtrar por categoría: </label>
            <select id="class-filter">
                <option value="all">Todos</option>
                <option value="Abarrotes">Abarrotes</option>
                <option value="Chiles, semillas y especias">Chiles, semillas y especias</option>
                <option value="Frutas y Verduras">Frutas y Verduras</option>
                <option value="Lacteos">Lacteos</option>
                <option value="Otros">Otros</option>
                <option value="Proteinas">Proteinas</option>
            </select>
        </div>

        <div class="loading">Cargando productos...</div>
        
   




<div class="product-table" id="product-list">
    <div class="product-card" data-class="Abarrotes">
        <h3>ACAI EN POLVO</h3>
        <p><strong>Categoría:</strong> Abarrotes</p>
        <p><strong>Unidad:</strong> Pieza</p>
        <div class="quantity-controls">
            <input type="number" class="quantity-input" step="1" value="0" onchange="updateQuantity(this)">
        </div>
        <p><strong>Precio:</strong> <span class="price">$348.75</span></p>
        <p><strong>Total:</strong> <span class="item-total">$0</span></p>
        <button class="notes-btn" onclick="toggleNotes(this)">Agregar Nota</button>
        <input type="text" class="notes-input" placeholder="Ingrese notas aquí" style="display: none;">
    </div>

    <div class="product-card" data-class="Proteinas">
        <h3>TOCINO</h3>
        <p><strong>Categoría:</strong> Proteinas</p>
        <p><strong>Unidad:</strong> Kilo</p>
        <div class="quantity-controls">
            <input type="number" class="quantity-input" step="any" value="0" onchange="updateQuantity(this)">
        </div>
        <p><strong>Precio:</strong> <span class="price">$182.00</span></p>
        <p><strong>Total:</strong> <span class="item-total">$0</span></p>
        <button class="notes-btn" onclick="toggleNotes(this)">Agregar Nota</button>
        <input type="text" class="notes-input" placeholder="Ingrese notas aquí" style="display: none;">
    </div>
</div>



























<!-- Add more product cards with your full product list here, ensuring data-class is set correctly (e.g., 'Frutas y Verduras' or 'Chiles, semillas y especias') -->
        </div>

        <div class="total-section" id="total-section">
            Total: $<span id="total-amount">0</span>
        </div>

        <!-- Resumen Section -->
        <div class="resumen">
            <h2>Resumen de Compra</h2>
            <table class="resumen-table" id="resumen-table">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Unidad</th>
                        <th>Precio</th>
                        <th>Total</th>
                        <th>Notas</th>
                    </tr>
                </thead>
                <tbody id="resumen-tbody">
                    <!-- Rows will be dynamically added here -->
                </tbody>
            </table>
            <div class="total-section" id="resumen-total-section">
                Total a Pagar: $<span id="resumen-total-amount">0</span>
            </div>
        </div>

        <!-- Checkbox section for order confirmation -->
        <div class="buttons">
            <input type="checkbox" id="confirm-checkbox">
            <label for="confirm-checkbox">Confirmo que los datos son correctos.</label>
        </div>

        <!-- Buttons for Print Resumen, Excel Export, WhatsApp, and Monday -->
        <div class="buttons">
            <button class="print-resumen-button" onclick="printResumen()">Imprimir Catalogo</button>
            <button class="excel-button" onclick="exportToExcel()">Exportar a Excel</button>
            <button class="whatsapp-button" onclick="sendToWhatsApp()">Texto WhatsApp</button>
            <button class="print-resumen-button" onclick="sendToMonday()">Enviar a Monday</button>
        </div>
    </div>

    <footer>
        © 2025 FRESH PRIME - ¡Frescura que da gusto! Todos los derechos reservados.
    </footer>

    <script>
        window.onload = function() {
            document.querySelector(".loading").style.display = "none";
            document.getElementById("product-list").style.display = "grid";
            
            // Add dynamic timestamp
            const timestampElement = document.getElementById("dynamic-timestamp");
            const now = new Date();
            const options = { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                timeZone: 'America/Mexico_City'
            };
            const formattedDate = now.toLocaleString('es-MX', options).replace(/,/, ' -');
            timestampElement.textContent = formattedDate;

            // Pre-load images for printing
            const logoImg = new Image();
            logoImg.src = 'https://i.imgur.com/HegNprK.jpeg';
            const bannerImg = new Image();
            bannerImg.src = 'https://i.imgur.com/0R2tBOV.jpeg';
        };

        function updateQuantity(input) {
            const unit = input.closest('.product-card').querySelector('p:nth-child(3)').textContent.replace('Unidad: ', '').toLowerCase();
            let value = parseFloat(input.value) || 0;

            const decimalUnits = ['atado', 'kilo', 'litro', 'manojo'];
            if (decimalUnits.includes(unit)) {
                if (value < 0) value = 0;
                input.step = "any";
            } else {
                value = Math.round(value);
                if (value < 0) value = 0;
                input.step = "1";
            }

            input.value = value.toFixed(2);
            updateTotal();
        }

        function toggleNotes(button) {
            const notesInput = button.nextElementSibling;
            if (notesInput.style.display === "none") {
                notesInput.style.display = "block";
                notesInput.focus();
            } else {
                notesInput.style.display = "none";
            }
            notesInput.addEventListener('input', updateTotal);
            updateTotal();
        }

        function updateTotal() {
            let total = 0;
            const cards = document.querySelectorAll('#product-list .product-card');
            const resumenTbody = document.getElementById('resumen-tbody');
            resumenTbody.innerHTML = '';

            cards.forEach(card => {
                const quantity = parseFloat(card.querySelector('.quantity-input').value) || 0;
                const price = parseFloat(card.querySelector('.price').textContent.replace('$', '').replace(',', '')) || 0;
                const unit = card.querySelector('p:nth-child(3)').textContent.replace('Unidad: ', '');
                const notesInput = card.querySelector('.notes-input');
                const notes = notesInput?.style?.display === "block" ? notesInput.value : '';

                const itemTotal = price * quantity;
                card.querySelector('.item-total').textContent = `$${itemTotal.toFixed(2)}`;

                if (quantity > 0) {
                    const newRow = resumenTbody.insertRow();
                    newRow.innerHTML = `
                        <td>${card.querySelector('h3').textContent}</td>
                        <td>${quantity.toFixed(2)}</td>
                        <td>${unit}</td>
                        <td>${card.querySelector('.price').textContent}</td>
                        <td>$${itemTotal.toFixed(2)}</td>
                        <td>${notes || 'Sin notas'}</td>
                    `;
                }

                total += itemTotal;
            });

            document.getElementById('total-amount').textContent = total.toFixed(2);
            document.getElementById('resumen-total-amount').textContent = total.toFixed(2);

            toggleBuyButton();
        }

        function toggleBuyButton() {
            const checkbox = document.getElementById('confirm-checkbox');
            const buyButton = document.querySelector('.buy-button');
            buyButton.disabled = !checkbox.checked;
        }

        function filterTable() {
            const filter = document.getElementById("class-filter").value;
            const cards = document.querySelectorAll('#product-list .product-card');

            cards.forEach(card => {
                const cardClass = card.getAttribute("data-class");
                if (filter === "all" || cardClass === filter) {
                    card.classList.add("visible-for-print");
                    card.style.display = "block";
                } else {
                    card.classList.remove("visible-for-print");
                    card.style.display = "none";
                }
            });
        }

        function printResumen() {
            // Step 1: Ensure the product list reflects the current filtered state
            filterTable(); // Re-apply category filter
            const searchQuery = document.getElementById("search-bar").value.toLowerCase();
            const cards = document.querySelectorAll('#product-list .product-card');
            
            cards.forEach(card => {
                const productName = card.querySelector('h3').textContent.toLowerCase();
                const cardClass = card.getAttribute("data-class");
                const filter = document.getElementById("class-filter").value;
                
                // Check if the card matches the category filter
                const matchesCategory = filter === "all" || cardClass === filter;
                // Check if the card matches the search query
                const matchesSearch = productName.includes(searchQuery);
                
                if (matchesCategory && matchesSearch) {
                    card.classList.add("visible-for-print"); // Mark as visible for print
                    card.style.display = "block"; // Ensure it’s visible on screen
                } else {
                    card.classList.remove("visible-for-print"); // Mark as hidden for print
                    card.style.display = "none"; // Hide on screen
                }
            });

            // Step 2: Temporarily show the product list for printing
            document.getElementById("product-list").classList.add("print-visible");

            // Step 3: Trigger the print dialog
            window.print();

            // Step 4: Restore the product list's default state after printing
            document.getElementById("product-list").classList.remove("print-visible");
        }

        let searchTimeout;
        document.getElementById("search-bar").addEventListener("keyup", function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const searchQuery = this.value.toLowerCase();
                const cards = document.querySelectorAll('#product-list .product-card');
                
                cards.forEach(card => {
                    const productName = card.querySelector('h3').textContent.toLowerCase();
                    const cardClass = card.getAttribute("data-class");
                    const filter = document.getElementById("class-filter").value;
                    
                    const matchesCategory = filter === "all" || cardClass === filter;
                    const matchesSearch = productName.includes(searchQuery);
                    
                    if (matchesCategory && matchesSearch) {
                        card.classList.add("visible-for-print");
                        card.style.display = "block";
                    } else {
                        card.classList.remove("visible-for-print");
                        card.style.display = "none";
                    }
                });
            }, 300);
        });

        let filterTimeout;
        document.getElementById("class-filter").addEventListener("change", function() {
            clearTimeout(filterTimeout);
            filterTimeout = setTimeout(() => {
                filterTable();
            }, 300);
        });

        function exportToExcel() {
            const cards = document.querySelectorAll('#product-list .product-card');
            let csvContent = "Producto,Cantidad,Unidad,Precio,Total,Notas\n";

            cards.forEach(card => {
                const quantity = parseFloat(card.querySelector('.quantity-input').value) || 0;
                if (quantity > 0) {
                    const product = card.querySelector('h3').textContent;
                    const unit = card.querySelector('p:nth-child(3)').textContent.replace('Unidad: ', '');
                    const price = parseFloat(card.querySelector('.price').textContent.replace('$', '').replace(',', '')) || 0;
                    const itemTotal = price * quantity;
                    const notesInput = card.querySelector('.notes-input');
                    const notes = notesInput?.style?.display === "block" ? notesInput.value : 'Sin notas';

                    csvContent += `"${product}",${quantity.toFixed(2)},"${unit}",$${price.toFixed(2)},$${itemTotal.toFixed(2)},"${notes}"\n`;
                }
            });
            csvContent += `\nTotal a Pagar,$${document.getElementById('resumen-total-amount').textContent},,,,,`;
            csvContent += `\nVisítanos en Instagram: https://www.instagram.com/fresh_prime_foods?igsh=MWFyendicGV4bnRxMQ%3D%3D&utm_source=qr`;

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", "orden_compra_fresh_prime.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function sendToWhatsApp() {
            const cards = document.querySelectorAll('#product-list .product-card');
            let message = "📋 *Orden de Compra - Fresh Prime*\n\n";
            message += "📅 " + document.getElementById("dynamic-timestamp").textContent + "\n\n";

            cards.forEach(card => {
                const quantity = parseFloat(card.querySelector('.quantity-input').value) || 0;
                if (quantity > 0) {
                    const product = card.querySelector('h3').textContent;
                    const unit = card.querySelector('p:nth-child(3)').textContent.replace('Unidad: ', '');
                    const price = parseFloat(card.querySelector('.price').textContent.replace('$', '').replace(',', '')) || 0;
                    const itemTotal = price * quantity;
                    const notesInput = card.querySelector('.notes-input');
                    const notes = notesInput?.style?.display === "block" ? notesInput.value : 'Sin notas';

                    message += `🍏 *Producto*: ${product}\n`;
                    message += `📏 *Cantidad*: ${quantity.toFixed(2)} ${unit}\n`;
                    message += `💵 *Precio*: $${price.toFixed(2)}\n`;
                    message += `📈 *Total*: $${itemTotal.toFixed(2)}\n`;
                    message += `📝 *Notas*: ${notes}\n\n`;
                }
            });

            message += `💰 *Total a Pagar*: $${document.getElementById('resumen-total-amount').textContent}\n\n`;
            message += `🌐 Visítanos en Instagram: https://www.instagram.com/fresh_prime_foods?igsh=MWFyendicGV4bnRxMQ%3D%3D&utm_source=qr\n`;
            message += `📞 Contacto: FreshPrimeGroup@outlook.com | Tel: (442) 422-5756, (442) 772-3974`;

            const encodedMessage = encodeURIComponent(message);
            const phoneNumber = "+524424225756";
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        function sendToMonday() {
            const apiToken = 'eyJhbGciOiJIUzI1NiJ9.eyJ0aWQiOjU0NDY4ODg1NiwiYWFpIjoxMSwidWlkIjo2ODYzNTc4MywiaWFkIjoiMjAyNS0wNy0zMFQwNjo1MDo0OS4wMTJaIiwicGVyIjoibWU6d3JpdGUiLCJhY3RpZCI6MjY1Mzg2NDIsInJnbiI6InVzZTEifQ.U8rc0hQRfOB70hAtPY6zdqd2ypj6UyGG3GMJmXkGfgQ';
            const boardId = '9701850249'; // Replace with your actual board ID
            const groupId = 'new_group'; // Default group; adjust if needed

            const cards = document.querySelectorAll('#product-list .product-card');
            let items = [];

            cards.forEach(card => {
                const quantity = parseFloat(card.querySelector('.quantity-input').value) || 0;
                if (quantity > 0) {
                    const product = card.querySelector('h3').textContent;
                    const unit = card.querySelector('p:nth-child(3)').textContent.replace('Unidad: ', '');
                    const price = parseFloat(card.querySelector('.price').textContent.replace('$', '').replace(',', '')) || 0;
                    const itemTotal = price * quantity;
                    const notesInput = card.querySelector('.notes-input');
                    const notes = notesInput?.style?.display === "block" ? notesInput.value : 'Sin notas';

                    items.push({
                        name: product,
                        column_values: JSON.stringify({
                            'text': product,
                            'numbers': { value: quantity },
                            'text1': unit, // Adjust column IDs based on your board
                            'numbers1': { value: price },
                            'numbers2': { value: itemTotal },
                            'text2': notes
                        })
                    });
                }
            });

            const query = `
                mutation ($boardId: ID!, $groupId: String!, $items: JSON!) {
                    create_items (board_id: $boardId, group_id: $groupId, item_name: "Order - ${new Date().toLocaleDateString()}", column_values: $items) {
                        id
                    }
                }
            `;

            fetch('https://api.monday.com/v2', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': apiToken
                },
                body: JSON.stringify({
                    query: query,
                    variables: {
                        boardId: boardId,
                        groupId: groupId,
                        items: JSON.stringify(items.map(item => item.column_values))
                    }
                })
            })
            .then(response => response.json())
            .then(data => console.log('Items created:', data))
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
